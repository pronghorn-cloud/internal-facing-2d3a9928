# =============================================================================
# Environment Configuration - INTERNAL (MS Entra ID)
# =============================================================================
# This configuration is for INTERNAL government applications using Microsoft
# Entra ID (Azure AD) authentication for employees with Microsoft 365 accounts.
#
# Copy this file to .env and fill in the values from your Azure AD app registration.
#
# PLACEHOLDER PATTERN: Values wrapped in {{VARIABLE_NAME}} are placeholders.
# Replace them with your actual values (remove the {{ }} brackets).
# Example: {{YOUR_AZURE_TENANT_ID}} → abc123-def456-ghi789
#
# See docs/AUTH-SETUP.md for detailed setup instructions.
# =============================================================================

# -----------------------------------------------------------------------------
# Application
# -----------------------------------------------------------------------------
NODE_ENV=production
PORT=3000
APP_NAME=Alberta Government Internal Application

# -----------------------------------------------------------------------------
# Database (PostgreSQL)
# -----------------------------------------------------------------------------
# Connection string format: postgresql://username@host:port/database
# For production, use Azure Database for PostgreSQL or similar managed service
DB_CONNECTION_STRING={{DATABASE_CONNECTION_STRING}}

# -----------------------------------------------------------------------------
# Session Management
# -----------------------------------------------------------------------------
# Generate a secure random string (32+ characters) for production
# Example: openssl rand -base64 32
SESSION_SECRET=
# ^^^ Required. Generate with: openssl rand -base64 32
SESSION_STORE=postgres

# -----------------------------------------------------------------------------
# Authentication - Microsoft Entra ID (Azure AD)
# -----------------------------------------------------------------------------
AUTH_DRIVER=entra-id

# Callback URL - where Entra ID redirects after authentication
# Must match the redirect URI configured in Azure AD app registration
# Format: https://your-domain.alberta.ca/api/v1/auth/callback
AUTH_CALLBACK_URL=https://internal.app.alberta.ca/api/v1/auth/callback

# Azure AD Tenant ID
# Found in Azure Portal > Azure Active Directory > Overview
ENTRA_TENANT_ID={{YOUR_AZURE_TENANT_ID}}

# Azure AD Application (client) ID
# Found in Azure Portal > App registrations > Your app > Overview
ENTRA_CLIENT_ID={{YOUR_AZURE_CLIENT_ID}}

# Azure AD Client Secret
# Created in Azure Portal > App registrations > Your app > Certificates & secrets
# IMPORTANT: Store securely (e.g., Azure Key Vault in production)
ENTRA_CLIENT_SECRET=
# ^^^ from Azure Portal > App registrations > Certificates & secrets

# Optional: Custom authority URL (defaults to Microsoft public cloud)
# ENTRA_AUTHORITY=https://login.microsoftonline.com/{tenant-id}/v2.0

# Optional: OpenID Connect scopes (space-separated)
# Default: "openid profile email"
# Add additional scopes if needed (e.g., "User.Read")
# ENTRA_SCOPE=openid profile email User.Read

# Optional: OAuth response type
# Default: "code" (authorization code flow)
# ENTRA_RESPONSE_TYPE=code

# Optional: OAuth response mode
# Default: "query" (parameters in query string)
# ENTRA_RESPONSE_MODE=query

# Optional: Default role for users with no assigned roles
# ENTRA_DEFAULT_ROLE=employee

# Optional: Logout URL
# Format: https://login.microsoftonline.com/{tenant-id}/oauth2/v2.0/logout
# ENTRA_LOGOUT_URL=https://login.microsoftonline.com/{{YOUR_AZURE_TENANT_ID}}/oauth2/v2.0/logout

# Optional: Post-logout redirect URI
# Where to redirect after logout from Entra ID
# ENTRA_POST_LOGOUT_REDIRECT_URI=https://internal.app.alberta.ca

# -----------------------------------------------------------------------------
# Service-to-Service Auth (Azure AD Client Credentials)
# -----------------------------------------------------------------------------
# Enable this to allow the public-facing application to call internal APIs.
# The public-facing app must have its own Azure AD app registration and use
# client_id + client_secret to obtain Bearer tokens via the Client Credentials flow.
#
# Azure AD Setup:
# 1. On THIS app registration: Expose an API > Add scope (e.g., api://{client-id}/.default)
# 2. On the PUBLIC-FACING app registration: API permissions > Add the above scope
# 3. Grant admin consent for the permission
SERVICE_AUTH_ENABLED=true

# Azure AD Tenant ID for token validation (defaults to ENTRA_TENANT_ID)
# SERVICE_AUTH_TENANT_ID={{YOUR_AZURE_TENANT_ID}}

# Expected audience claim in service tokens
# Defaults to api://{ENTRA_CLIENT_ID} if not set
# SERVICE_AUTH_AUDIENCE=api://{{YOUR_AZURE_CLIENT_ID}}

# Comma-separated list of allowed client IDs from public-facing applications
# This restricts which Azure AD applications can call the internal API
SERVICE_AUTH_ALLOWED_CLIENT_IDS={{PUBLIC_APP_CLIENT_ID}}

# -----------------------------------------------------------------------------
# Frontend
# -----------------------------------------------------------------------------
# URL where the Vue.js app is hosted
WEB_URL=https://internal.app.alberta.ca

# CORS origins (comma-separated)
# Include both internal frontend and public-facing app origins
CORS_ORIGIN=https://internal.app.alberta.ca,https://public.app.alberta.ca

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
# Rate limiting - max requests per 15 minutes per IP
RATE_LIMIT_MAX=1000

# Rate limiting for auth endpoints - stricter limits
AUTH_RATE_LIMIT_MAX=10

# Rate limiting for service-to-service API endpoints
SERVICE_RATE_LIMIT_MAX=500

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
# Log level: error, warn, info, debug
LOG_LEVEL=info

# Log format: combined, common, dev, short, tiny
LOG_FORMAT=combined

# -----------------------------------------------------------------------------
# OpenTelemetry (LOG-007)
# Cloud-agnostic telemetry — works with any OTLP-compatible backend
# (Azure Monitor, Datadog, Grafana, Jaeger, etc.)
# -----------------------------------------------------------------------------
OTEL_ENABLED=false
OTEL_SERVICE_NAME=aim-api
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318
