# =============================================================================
# Environment Configuration - Development
# =============================================================================
# This is a template for local development with mock authentication.
# Copy this file to .env and adjust values as needed.
#
# PLACEHOLDER PATTERN: Values wrapped in {{VARIABLE_NAME}} are placeholders.
# Replace them with your actual values (remove the {{ }} brackets).
#
# For production deployment, use .env.internal.example (MS Entra ID)
#
# Validate configuration: npm run validate-env
# =============================================================================

# -----------------------------------------------------------------------------
# Application
# -----------------------------------------------------------------------------
NODE_ENV=development
PORT=3000
HOST=localhost
APP_NAME=Alberta Government Internal Application

# -----------------------------------------------------------------------------
# Database (PostgreSQL) - Azure PostgreSQL Standard Compliant
# -----------------------------------------------------------------------------
# Connection string format: postgresql://username@host:port/database?sslmode=require
# For Azure PostgreSQL Flexible Server, use SSL with certificate validation

# Docker Compose PostgreSQL credentials (used by docker-compose.yml)
POSTGRES_USER=appuser
POSTGRES_PASSWORD=
# ^^^ Set a password (e.g., openssl rand -hex 16)

# Connection string (required)
# Format: postgresql://username@host:port/database
# Must match POSTGRES_USER and POSTGRES_PASSWORD above
DB_CONNECTION_STRING=

# Connection pool configuration (Azure standard requirements)
DB_POOL_MIN=2                    # Minimum pool size (default: 2)
DB_POOL_MAX=10                   # Maximum pool size (default: 10)
DB_IDLE_TIMEOUT=30000            # Idle connection timeout in ms (default: 30000)
DB_CONNECTION_TIMEOUT=5000       # Connection timeout in ms (default: 5000)
DB_STATEMENT_TIMEOUT=30000       # Statement timeout in ms (default: 30000)

# SSL/TLS configuration (Azure standard: MUST use TLS 1.2+ in production)
# For local development, set to false. For production, MUST be true.
DB_SSL_REJECT_UNAUTHORIZED=false # Set to 'true' in production (certificate validation)

# Metrics and monitoring
DB_ENABLE_METRICS=false          # Enable pool metrics collection (auto-enabled in production)

# -----------------------------------------------------------------------------
# Session Management
# -----------------------------------------------------------------------------
# For production, generate a secure random string:
# openssl rand -base64 32
SESSION_SECRET=
# ^^^ Required. Generate with: openssl rand -base64 32
SESSION_STORE=postgres
SESSION_MAX_AGE=28800000                 # 8 hours (Protected B); rolling resets on activity
SESSION_COOKIE_SAME_SITE=lax
# SESSION_COOKIE_SECURE will be auto-set based on NODE_ENV

# -----------------------------------------------------------------------------
# Authentication - Mock Driver (Development)
# -----------------------------------------------------------------------------
AUTH_DRIVER=mock

# Auth callback URL - Optional in most cases
# The callback URL is auto-detected in this priority:
# 1. AUTH_CALLBACK_URL (if explicitly set)
# 2. API_URL + /api/v1/auth/callback
# 3. RENDER_EXTERNAL_URL (auto-set by Render.com)
# 4. HOST:PORT derivation (for local development)
#
# Only set this if auto-detection doesn't work for your deployment:
# AUTH_CALLBACK_URL=http://localhost:3000/api/v1/auth/callback
#
# Alternatively, set API_URL for your deployment:
# API_URL=https://your-api.example.com

# For Entra ID (production), see .env.internal.example

# -----------------------------------------------------------------------------
# Service-to-Service Auth (Azure AD Client Credentials)
# -----------------------------------------------------------------------------
# Used by the public-facing application to access internal APIs.
# The public-facing app authenticates with its own client_id + client_secret
# against Azure AD, then sends Bearer tokens to /api/v1/public/* endpoints.
SERVICE_AUTH_ENABLED=false
# In production, set to true and configure:
# SERVICE_AUTH_TENANT_ID=         # Defaults to ENTRA_TENANT_ID
# SERVICE_AUTH_AUDIENCE=          # Defaults to api://{ENTRA_CLIENT_ID}
# SERVICE_AUTH_ALLOWED_CLIENT_IDS= # Comma-separated client IDs of public-facing apps

# -----------------------------------------------------------------------------
# Frontend
# -----------------------------------------------------------------------------
WEB_URL=http://localhost:5173
CORS_ORIGIN=http://localhost:5173
CORS_CREDENTIALS=true

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
# Rate limiting - max requests per 15 minutes per IP
RATE_LIMIT_MAX=10000
AUTH_RATE_LIMIT_MAX=100
SERVICE_RATE_LIMIT_MAX=10000

# Host header validation (REQ-P1-01) — comma-separated allowed hostnames
# Required in production to prevent host header injection
# ALLOWED_HOSTS=your-app.alberta.ca

# Token encryption key (REQ-P2-03) — encrypt OAuth tokens in session storage
# Generate with: openssl rand -base64 32
# TOKEN_ENCRYPTION_KEY=

# Content Security Policy
# HELMET_CSP=false

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
LOG_LEVEL=debug
LOG_FORMAT=dev
LOG_PII=true

# -----------------------------------------------------------------------------
# OpenTelemetry (LOG-007)
# Cloud-agnostic telemetry — works with any OTLP-compatible backend
# (Azure Monitor, Datadog, Grafana, Jaeger, etc.)
# -----------------------------------------------------------------------------
OTEL_ENABLED=false
OTEL_SERVICE_NAME=aim-api
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
FEATURE_ANALYTICS=true
FEATURE_HEALTH_CHECK=true
